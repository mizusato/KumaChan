do Window.show
    | then (Window.move-to-screen-center);

do Window.closed
    | concat-map (&(_)(exit 0))
    | forever;

do @add
    | concat-map ( &(_) (TodoInput.set-text '') )
    | forever;

do @state
    | concat-map (& {list, current?}
        let update-list := (TodoList.set-items (list | map adapt-item) current?),
        switch current?:
        case Just current:
            let current-item := (list.filter (&{id} $(id = current))),
            let show-current := (show-item $(current-item at 0)),
            merge [update-list, show-current],
        case N/A:
            update-list,
        end
    )
    | forever;

do TodoList.current-item
    | concat-map ( &(key?)
        switch key?:
        case Just key:
            println ("Current: #" key),
        case N/A:
            println 'Current N/A',
        end
    )
    | catch* crash
    | forever;
