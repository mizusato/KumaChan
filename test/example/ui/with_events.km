import assets from './assets';

do ui-init 'WebQuick WithEvents' DOM;

do ui-inject-css [assets::style-css];

do UI::ExitWhenWindowClosed;

public function with-mouse-position:
    ( &((Float,Float), (&(NoExcept*[(Float,Float)])(NoExcept*[UI::Node])))
        NoExcept*[UI::Node] )
    ( &(init, k)
        ~ with-reactive* &(pos) := init,
        ~ then* &(x) := random,
        UI::WithEvents
            (dom-event ("mousemove.hook#" (str x))
                (dom-callback ( &(ev)
                    let x := ev.get-float 'webuiCurrentTargetX',
                    let y := ev.get-float 'webuiCurrentTargetY',
                    $(pos <- (x, y))
                )))
            (k (watch pos))
    );

private const DOM: NoExcept*[UI::Node]
    UI::Styled ['container']
    (UI::Container [
        ~ with-mouse-position &(pos) := (0.0, 0.0),
        UI::Styled ['box']
        (UI::Container [
            UI::TextWatch (pos | map* (&(x,y)("x=#, y=#" (str x) (str y))))
        ])
    ]);
